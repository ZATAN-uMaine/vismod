version: '3'
services:
  devcontainer:
    build: ./python-dev
    container_name: vismod-dev
    command: "sleep infinity"
    # may need to be changed for different users
    user: "1000:1000"
    volumes:
      - "..:/workspace:cached"
    working_dir: /workspace
    ports:
      - "4000:4000"
      - "5000:5000"
      
  influx:
    image: influxdb:latest
    container_name: influx
    ports:
    - "8086:8086"
    environment:
      - DOCKER_INFLUXDB_INIT_MODE=setup
      - DOCKER_INFLUXDB_INIT_USERNAME=zatan
      - DOCKER_INFLUXDB_INIT_PASSWORD=Zatan123!
      - DOCKER_INFLUXDB_INIT_ORG=zatan
      - DOCKER_INFLUXDB_INIT_BUCKET=main
    volumes:
     # the config volume exists because the admin token is written there on first use
      - influx_config:/etc/influxdb2
      - influx_storage:/var/lib/influxdb2
      # startup script
      - ./influx/influx-setup.sh:/docker-entrypoint-initdb.d/influx-setup.sh:ro
      # seed data
      - ./influx/example-data.csv:/example-data.csv

  grafana:
    image: grafana/grafana-oss
    container_name: grafana
    ports:
      - '3000:3000'
    environment:
      - INFLUX_TOKEN=OHoaJ4ye-oO7nfg2AMbG5GdadRdlXI-KeVvtv6632cUCfVMF534w47AfMD9MfzAun_xj53zi67ATPU3kZr5a5g==
      - INFLUX_PASS=Zatan123!
    volumes:
      - grafana_storage:/var/lib/grafana
      - ./grafana/grafana.ini:/etc/grafana/grafana.ini:ro
      # the provisioning directory holds YAML templates for data sources and dashboard that will be loaded on the first run
      - ./grafana/provisioning:/etc/grafana/provisioning:ro
      # the dashboard directory saves reuseable dashboard
      # note: you maybe have to chmod it
      - ./grafana/dashboards:/var/lib/grafana/dashboards
volumes:
  influx_storage:
  influx_config:
  grafana_storage:
  workspace:
